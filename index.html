function handleInteraction(id) {
    const targetPiece = gameState.pieces[id];
    
    // 1. SELECTING A PIECE
    if (gameState.selectedNode === null) {
        // Only select if it's your turn AND it's your piece
        if (targetPiece && targetPiece.team === gameState.turn) {
            gameState.selectedNode = id;
        }
    } 
    // 2. DESELECTING OR SWITCHING SELECTION
    else if (targetPiece && targetPiece.team === gameState.turn) {
        // If you click another one of your own pieces, just switch the selection
        gameState.selectedNode = id;
    }
    // 3. ATTEMPTING A MOVE OR CAPTURE
    else {
        const validMoves = getValidMoves(gameState.selectedNode);
        
        // Only move if the node is in the valid moves list
        if (validMoves.includes(id)) {
            // Win condition check
            if (targetPiece && targetPiece.type === 'king') {
                alert(gameState.turn.toUpperCase() + " WINS THE WAR!");
                location.reload();
            }
            
            // Execute Move
            gameState.pieces[id] = gameState.pieces[gameState.selectedNode];
            delete gameState.pieces[gameState.selectedNode];
            
            // Switch Turn
            gameState.turn = gameState.turn === 'blue' ? 'red' : 'blue';
            gameState.selectedNode = null; // Clear selection after move
            
            sendMove(); // Sync with the other player
        } else {
            // If the move is invalid, just deselect
            gameState.selectedNode = null;
        }
    }
    drawBoard();
    updateStatus();
}
